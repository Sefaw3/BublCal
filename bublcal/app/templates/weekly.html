{% extends "base.html" %}
{% load static %}

{% block title %}Weekly Schedule{% endblock title %}

{% block styles %}
    <link rel="stylesheet" type="text/css" href="{% static 'main/weekly.css' %}">
{% endblock styles %}

{% block content %}
    <div class="container pt-4 pb-2">

        <div class="row-fluid d-flex justify-content-evenly">
            <a class="btn btn-primary" role="button" href="{{prevWeekLink}}">Last Week</a>
            <a style="font-size: calc(1.325rem + .9vw);font-weight: 500;line-height: 1.2;">{{ month_year }}</a>
            <a class="btn btn-primary" role="button" href="{{nextWeekLink}}">Next Week</a>
        </div>

        <h4 class="text-center">Week of {{ day_of_week }}, the {{ day }}</h4>

        <div id="week_table" class="container table-responsive">
            <table class="table table-bordered">
                <tr class="weekdays">
                    {% for name, date in week.items %}
                        <th class="weekly-th text-center"> 
                            
                            <a href="/app/daily/{{month}}/{{date}}/{{year}}">{{ name }} {{ date }}</a>

                        </th>
                    {% endfor %}
                </tr>

                <!--Weekly Bubls will go here -->
                <tr class="vh-100">
                    {% for name, date in week.items %}
                        <td class="weekly-td">
                            {% for bubl in bubls %}
                                {% if bubl.date.day == date %}
                                    <button
                                            type="button"
                                            class="btn btn-primary bubble"
                                            data-bs-toggle="modal"
                                            data-bs-target="#bubl-{{bubl.id}}"
                                            title="At {{bubl.time}}">{{ bubl.name }}
                                    </button>

                                    <!-- Bubble Info View -->
                                    <div class="modal fade" id="bubl-{{bubl.id}}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">{{ bubl.name }}</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    At {{ bubl.time }} {{ bubl.date }} for {{ bubl.length }} minutes
                                                    <br>
                                                    {{ bubl.note }}
                                                </div>
                                                <div class="modal-footer">
                                                    <a class="btn btn-danger" href="/app/kill-bubl/{{bubl.id}}" role="button">Delete</a>
                                                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#bubl-{{ bubl.id }}-edit">Edit</button>
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Bubble Edit Form -->
                                    <div class="modal fade" id="bubl-{{ bubl.id }}-edit" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <form method="post" action="/app/modify/{{bubl.id}}/">{% csrf_token %}
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="exampleModalLabel">Edit Bubble</h5>
                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                    </div>

                                                    <div class="modal-body">

                                                        <!-- Name -->
                                                        <div class="input-group mb-3">
                                                            <input name="name" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" placeholder="Bubble Name" value="{{bubl.name}}" required>
                                                        </div>

                                                        <!-- Note -->
                                                        <div class="input-group mb-3">
                                                            <input name="note" type="text" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" placeholder="Extra Note" value="{{bubl.note}}">
                                                        </div>

                                                        <!-- Date & Time -->
                                                        <div class="input-group mb-3">
                                                            <input name="time" type="time" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" value="{{bubl.time.hour|stringformat:'02d'}}:{{bubl.time.minute|stringformat:'02d'}}" required>
                                                            <input name="date" type="date" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" value="{{bubl.date.year}}-{{bubl.date.month|stringformat:'02d'}}-{{bubl.date.day|stringformat:'02d'}}" required>
                                                        </div>

                                                        <!-- Length -->
                                                        <div class="input-group mb-3">
                                                            <input name="length" type="number" class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default" value="{{bubl.length}}" placeholder="Length (minutes)">
                                                        </div>

                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                        <button type="submit" class="btn btn-primary">Save changes</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                        </td>
                    {% endfor %}
                </tr>
            </table>
        </div>
    </div>
{% endblock content %}